# ccc (Claude Code Supervisor) 项目宪章

## 版本信息

**版本**: 1.0.0
**批准日期**: 2025-01-14
**最后修订**: 2025-01-14

### 变更历史

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| 1.0.0 | 2025-01-14 | 首次创建，建立 6 条核心原则 |

### 修订说明

**版本 1.0.0**:
- 新增核心原则 (6条)
- 新增质量门禁
- 新增治理规则
- 新增 Git 工作流规范

---

## 特别说明：使用中文

**本项目所有开发文档必须使用中文编写。**

1. 我的母语是中文，使用中文沟通更加高效准确。
2. SpecKit 开发流程创建的所有文档（spec.md、plan.md、tasks.md 等）必须使用中文编写。
3. 用户故事、需求描述、验收场景、任务说明全部使用中文。
4. 代码注释优先使用中文，Go doc 注释使用中文。

---

## 核心原则

### 原则一：单二进制分发 (不可协商)

最终产物必须是单一的、静态链接的二进制可执行文件，无运行时依赖。

- 所有依赖必须在构建时静态链接（Go 默认行为）
- 二进制文件必须在目标系统上可直接运行，无需额外安装
- 分发方式必须使用预编译二进制文件，支持所有目标平台（darwin-amd64、darwin-arm64、linux-amd64、linux-arm64）
- 禁止需要外部配置文件、共享库或运行时依赖才能执行

**理由**: ccc 是面向用户的 CLI 工具，下载后必须"开箱即用"。静态链接确保在不同 Linux 发行版和 macOS 版本之间的兼容性，避免依赖地狱。

### 原则二：代码质量标准

所有代码在合并前必须通过自动化质量检查。

- 所有 Go 源文件必须使用 `gofmt` 格式化（CI 强制执行）
- `go vet` 必须无警告通过（CI 强制执行）
- 必须遵循标准 Go 命名规范：
  - 导出: `PascalCase`
  - 私有: `camelCase`
  - 常量: `PascalCase` 或 `UPPER_SNAKE_CASE`
- 导出的函数和类型必须有 Go doc 注释

**理由**: 一致的代码风格和静态分析可以防止常见错误，保持代码可读性。

### 原则三：测试规范

所有代码变更必须通过自动化测试验证。

- 单元测试必须使用 `go test ./...`
- CI 中必须启用竞态检测器（`go test -race ./...`）
- 测试必须使用 `CCC_CONFIG_DIR` 进行隔离，避免影响用户配置
- 通过函数覆盖方式进行 Mock（例如 `getClaudeDirFunc`）

**理由**: 竞态检测可以及早发现并发错误。测试隔离确保开发者可以在不影响本地 Claude Code 配置的情况下运行测试。

### 原则四：向后兼容

配置文件格式变更必须保持向后兼容。

- 现有的 `~/.claude/ccc.json` 文件在更新后必须仍然有效
- 新配置字段必须有合理的默认值
- 已弃用的字段必须至少支持一个主版本周期
- 破坏性变更需要主版本号升级和迁移文档

**理由**: 用户升级 ccc 时不应手动编辑配置文件。向后兼容可以减少升级阻力。

### 原则五：跨平台支持

ccc 必须平等支持所有目标平台。

- 支持矩阵：darwin-amd64、darwin-arm64、linux-amd64、linux-arm64
- 构建脚本（`build.sh`）必须通过 `--all` 标志为所有平台生成二进制文件
- 平台特定代码必须最小化并清晰隔离
- 所有支持平台上的行为必须一致

**理由**: ccc 用户使用不同的操作系统和架构。不一致的行为或缺失平台会破坏用户信任。

### 原则六：错误处理与可观测性

所有错误必须明确且可操作。

- 错误必须使用 `fmt.Errorf` 包装返回上下文
- 错误消息必须指导用户解决问题
- CLI 输出必须使用适当的流（stdout 用于成功，stderr 用于错误）
- 配置验证必须及早进行，并提供清晰的错误消息

**理由**: CLI 工具的交互渠道有限。清晰的错误消息可以减少支持负担并改善用户体验。

---

## 质量门禁

每次变更在合并前必须通过以下门禁：

1. **代码规范门禁**: `gofmt`、`go vet`、`shellcheck`、`markdownlint`（通过 `./check.sh --lint`）
2. **测试门禁**: `go test -v -race -tags=ci ./...`（通过 `./check.sh --test`）
3. **构建门禁**: `./build.sh --all` 必须为所有平台成功构建（通过 `./check.sh --build`）

所有门禁通过 CI 强制执行。未通过任何门禁的 Pull Request 不得合并。

---

## Git 工作流

### 分支管理

- 主分支：`main`
- 所有变更必须通过 Pull Request 进行
- 禁止直接提交到 `main`

### 提交消息格式

使用 Conventional Commits 前缀：
- `feat:` - 新功能
- `fix:` - Bug 修复
- `docs:` - 文档变更
- `ci:` - CI/CD 变更
- `build:` - 构建系统变更
- `refactor:` - 代码重构
- `test:` - 测试添加/修改

### 审查流程

- 所有 PR 在合并前必须经过审查
- CI 必须通过（`./check.sh` 全部检查）
- 审查者应确认质量门禁已通过

---

## 治理规则

### 宪章权威性

本宪章在与其他项目文档冲突时具有最高权威。
如有疑问，请遵循这些原则的精神：简洁、质量、用户体验。

### 修订流程

对本宪章的修改需要：

1. 明确记录变更理由
2. 项目维护者审查和批准
3. 向后兼容性评估
4. 根据语义版本进行版本号升级：
   - MAJOR：向后不兼容的治理/原则删除或重新定义
   - MINOR：新增原则/章节或实质性扩展指导
   - PATCH：澄清、措辞、拼写错误修复、非语义改进

### 合规审查

- 所有 PR 应审查是否符合宪章要求
- 复杂度必须合理（参考简洁原则）
- 使用 `docs/project.md`、`README.md` 和 `.specify/memory/constitution.md` 作为开发指导
