# Proposal: product-roadmap

## Summary

本提案定义了 ccc 产品从当前配置切换工具演进为 AI 员工管理平台的完整路线图。包含以下主要功能模块：

1. **Web 服务** - 提供 HTTP API 管理 Claude Code
2. **Agent SDK 封装** - 封装 Claude Code 为可复用的 SDK
3. **Web 界面** - 类似 Manus 的网页版 Claude Code
4. **多 Agent 支持** - 支持 OpenCode、Gemini CLI 等
5. **中心服务器** - 中性化的服务器，管理所有 ccc 实例

## Motivation

### 产品愿景
打造一个企业级的 AI 员工管理平台，用户可以：
- 在网页上创建和管理 AI 员工
- 通过聊天界面安排工作
- 批量创建员工处理相同任务
- 拉群让多个 AI 协作完成复杂任务

### 当前限制
1. ccc 只是配置切换工具，不具备服务能力
2. 无法通过 API 管理 Claude Code
3. 缺少 Web 界面，只能在命令行使用
4. 只支持 Claude Code，不支持其他 AI CLI 工具

## 功能模块规划

### Phase 1: Web 服务（基于反向代理）
**目标**: 提供 HTTP API 管理 Claude Code 实例

**核心功能**:
- 启动/停止 Claude Code
- 发送消息并获取响应
- 配置 Supervisor 模式
- WebSocket 实时通信

**技术方案**:
- 使用 Go 标准库 net/http
- 基于 add-dynamic-reverse-proxy 的代理服务器扩展
- WebSocket 用于实时流式输出

### Phase 2: Agent SDK 封装
**目标**: 将 Claude Code 封装为可复用的 Go SDK

**核心功能**:
- 进程管理（启动、停止、监控）
- 输入输出流处理
- 会话管理
- 配置管理

**技术方案**:
- 参考 `internal/claude` 包设计
- 创建完整的 SDK 抽象层
- 支持同步和异步 API

### Phase 3: Web 界面
**目标**: 提供类似 Manus 的网页版 Claude Code

**核心功能**:
- 聊天界面（类似 ChatGPT）
- 文件浏览和编辑
- 命令执行输出显示
- 实时流式响应

**技术方案**:
- 前端: React/Vue + WebSocket
- 后端: Go Web 服务
- 参考 opcode 项目的界面设计

### Phase 4: 多 Agent 支持
**目标**: 支持 OpenCode、Gemini CLI、Codex 等其他 AI CLI

**核心功能**:
- 统一的 Agent 接口
- 提供商配置管理
- Agent 能力声明
- 自动路由到合适的 Agent

**技术方案**:
- 定义统一的 Agent 接口
- 实现适配器模式支持不同 CLI
- 配置文件扩展支持多 Agent

### Phase 5: 中心服务器
**目标**: 中性化的服务器，管理所有 ccc 实例

**核心功能**:
- 设备管理（注册、心跳）
- 用户认证和授权
- 员工模板管理
- 批量创建 AI 员工
- 多人协作聊天

**技术方案**:
- 服务器: Go + PostgreSQL + Redis
- 通信: WebSocket + HTTPS
- 部署: Docker + Kubernetes

## 架构设计

### 整体架构
```
┌─────────────────────────────────────────────────────┐
│                   Web Browser                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │ Chat UI     │  │ File Manager│  │  Dashboard  │  │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  │
└─────────┼──────────────────┼──────────────────┼─────┘
          │                  │                  │
          └──────────────────┼──────────────────┘
                             ▼
┌─────────────────────────────────────────────────────┐
│              Central Server (Go)                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │User Auth    │  │Agent Manager│  │Job Manager  │  │
│  └─────────────┘  └──────┬──────┘  └─────────────┘  │
└──────────────────────────┼───────────────────────────┘
                           │
         ┌─────────────────┼─────────────────┐
         ▼                 ▼                 ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  ccc Agent 1 │  │  ccc Agent 2 │  │  ccc Agent N │
│  (Claude)    │  │  (Gemini)    │  │  (OpenCode)  │
└──────────────┘  └──────────────┘  └──────────────┘
```

### 模块依赖关系
1. 中心服务器依赖 Web 服务
2. Web 服务依赖 Agent SDK
3. Web 界面依赖 Web 服务
4. 多 Agent 支持依赖 Agent SDK

## 实施计划

### 阶段 1: 基础 Web 服务（2-3 周）
- 扩展反向代理添加管理 API
- 实现 Claude Code 进程管理
- 实现 WebSocket 支持
- 添加基本认证

### 阶段 2: Agent SDK（1-2 周）
- 完善 `internal/claude` 包
- 添加会话管理
- 添加事件系统
- 编写完整测试

### 阶段 3: Web 界面 MVP（2-3 周）
- 实现聊天界面
- 实现文件浏览器
- 实现命令输出显示
- WebSocket 实时通信

### 阶段 4: 多 Agent 支持（2-3 周）
- 定义 Agent 接口
- 实现 Gemini CLI 适配器
- 实现 OpenCode 适配器
- 配置管理 UI

### 阶段 5: 中心服务器（3-4 周）
- 用户认证系统
- 设备管理
- 员工模板
- 批量创建功能
- 协作聊天

## 风险与缓解

### 技术风险
1. **Claude Code API 稳定性**: 可能随版本变化
   - 缓解: 抽象层隔离变化，版本适配

2. **WebSocket 可靠性**: 网络断开处理
   - 缓解: 自动重连，状态同步

3. **多进程管理**: 资源泄漏风险
   - 缓解: 完善的资源清理机制

### 产品风险
1. **市场需求**: 不确定用户需求
   - 缓解: 小步迭代，快速验证

2. **竞争**: 类似产品出现
   - 缓解: 专注差异化功能

## Open Questions

1. **部署方式**: ccc 程序如何部署？
   - *倾向*: 用户手动安装，中心服务器云端部署

2. **数据存储**: 聊天历史存储在哪里？
   - *倾向*: 本地 SQLite + 可选云端同步

3. **付费模式**: 如何盈利？
   - *倾向*: 开源免费，企业版收费

4. **隐私安全**: 代码隐私如何保护？
   - *倾向*: 本地优先，可选云端
